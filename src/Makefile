#set this in local.mk
#PROGRAM = main

EXTRA_COMPONENTS = \
	extras/sntp \
	extras/http-parser \
	extras/dhcpserver \
    extras/rboot-ota \
	$(abspath ../components/esp-wifi-config) \
	$(abspath ../components/esp-wolfssl)

FLASH_SIZE ?= 8

EXTRA_WOLFSSL_CFLAGS = \
	-DWOLFSSL_USER_SETTINGS \
	-DWOLFSSL_STATIC_RSA \
	-DUSE_SLOW_SHA \
	-DUSE_SLOW_SHA2 \
	-DHAVE_AESGCM \
	-DNO_MD5 \
	-DNO_FILESYSTEM \
	-DNO_WRITEV \
	-DNO_WOLFSSL_SERVER \
	-DNO_RABBIT \
	-DNO_DH \
	-DNO_PWDBASED \
	-DNO_DES3 \
	-DNO_ERROR_STRINGS \
	-DNO_OLD_TLS \
	-DNO_RC4 \
	-DNO_PSK \
	-DNO_MD4 \
	-DNO_HC128 \
	-DNO_DEV_RANDOM \
	-DNO_SESSION_CACHE \
    -DNO_DSA \
 	-DWOLFSSL_SHA512 \
 	-DWOLFSSL_SHA384 \
	-DHAVE_ECC \
	-DHAVE_ECC384 \
	-DHAVE_ECC_SIGN \
	-DHAVE_ECC_VERIFY \
	-DHAVE_ECC_KEY_IMPORT \

#	-DDEBUG_WOLFSSL \

#   -DNO_SHA \
#	-DLARGE_STATIC_BUFFERS \
#	-DSTATIC_CHUNKS_ONLY \
#	-DRECORD_SIZE=1024 \
#	-DHAVE_ONE_TIME_AUTH \
#	-DHAVE_CHACHA \
#	-DHAVE_POLY1305 \
#	-DHAVE_HKDF \
#	-DHAVE_ED25519 \
#	-DHAVE_CURVE25519 \
#	-DNO_CODING \
#	-DNO_INLINE \
#	-DBUILD_TLS_RSA_WITH_AES_128_GCM_SHA256 \

esp-wolfssl_CFLAGS += $(EXTRA_WOLFSSL_CFLAGS)

#PROGRAM_SRC_DIR = . ../common

EXTRA_CFLAGS += -I../common
EXTRA_CFLAGS += $(EXTRA_WOLFSSL_CFLAGS)
EXTRA_CFLAGS += -DTCP_MSS=1460 -DTCP_WND=2920
ifdef OTAVERSION
EXTRA_CFLAGS += -DOTAVERSION=\"$(OTAVERSION)\"
endif
#EXTRA_CFLAGS += -DTCP_QUEUE_OOSEQ=0 -DLWIP_TCP_SACK_OUT=0
#EXTRA_CFLAGS += -DTCP_OVERSIZE=0
#EXTRA_CFLAGS += -DLWIP_TCP_KEEPALIVE=0

include $(SDK_PATH)/common.mk

monitor:
	$(FILTEROUTPUT) --port $(ESPPORT) --baud 115200 --elf $(PROGRAM_OUT)
